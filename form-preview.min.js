/**
 * jQuery data form preview plugin.
 *
 * @author volter9
 * @license MIT
 * @website https://github.com/Volter9/jQuery-Form-Preview
 */
(function($){if(typeof $.fn.preview==='function'||typeof $.fn.extract==='function'){throw new Error('$.fn.preview or $.fn.extract is already defined!');}
function Preview(options){this.target=options.target;this.form=$(options.form).first();this.fields=this.form.find(options.fields);this.event=options.event;this.initiated=false;this.data={};this.processors={};options.init(this);this.setup();}
Preview.prototype.version='v0.1';Preview.prototype.constructor=Preview;Preview.prototype.setup=function(){if(this.initiated){return;}
var _this=this;this.fields.on(this.event,function(){var $this=$(this);var data=$this.extract();if(!data){return;}
data.value=_this.process(data.name,data.value);_this.update(data.name,data.value);_this.preview(data.name);});this.collect();this.preview();};Preview.prototype.process=function(name,value){var oldValue=value;var processor=this.processors[name];if(processor){value=processor(name,value,this.data);}
if(value===undefined){value=oldValue;}
return value;};Preview.prototype.collect=function(){var _this=this;this.fields.each(function(){var $this=$(this);var data=$this.extract();data.value=_this.process(data.name,data.value);if(data){_this.update(data.name,data.value);}});};Preview.prototype.update=function(name,value){if(!name){return false;}
this.data[name]=value;};Preview.prototype.preview=function(field){if(!field){var _this=this;$.each(this.data,function(property){_this.preview(property);});return;}
var value=this.data[field];var element=this.target.find('[data-preview='+field+']');var attribute=element.attr('data-attr'),pattern=element.attr('data-pattern');if(pattern){value=pattern.replace(/%s/g,value);}
if(!attribute){element.html(value);}
else{element.attr(attribute,value);}};Preview.prototype.addProcessor=function(name,callback,force){if(this.processors[name]&&!force){return false;}
this.processors[name]=callback;};$.fn.extract=function(){var attribute=this.attr('name');if(!attribute){return false;}
return{name:attribute,value:this.val()};};$.fn.preview=function(options){if(typeof options.form!=='string'){throw new TypeError('Option "form" must be a string. Given: '+typeof options.form);}
var byDefault={fields:'input, textarea, select',event:'input',init:function(){}};options=$.extend(byDefault,options);options.target=this;var preview=new Preview(options);return preview;};})(jQuery);